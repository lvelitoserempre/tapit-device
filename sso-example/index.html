<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>SSO EXAMPLE</title>
  <meta content="width=device-width,initial-scale=1" name="viewport">

  <link rel="stylesheet" href="https://clube-brahma-sso.web.app/assets/styles/tailwind.css">
  <script src="https://www.gstatic.com/firebasejs/7.15.4/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.15.4/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.15.4/firebase-firestore.js"></script>

  <script>
    const TAPIT_ORIGIN = 'https://clube-brahma-sso.web.app';
    const CHANNEL = 'TAPIT';

    /*************************************************************************
     Event listener to listen to the events of the TAPIT channel
     ************************************************************************/
    window.addEventListener("message", function (event) {
      if (event.data && event.data.channel === CHANNEL) {
        performAction(event.data.action, event.data.data)
      }
    }, false);

    /*****************
     Actions
     ********************/
    function performAction(action, data) {
      switch (action) {
        case 'set-logged-user':
          /* This action is executed when the user credentials were successfully validated,
          it returns in 'data' the information of the user who started the session,
          in this example the data on the iframe is shown and the customToken is obtained
          to be able to login sending it as a parameter of the 'signInWithCustomToken' function*/
          if (data) {
            document.getElementById('iframe-user-data').innerText = JSON.stringify(data);
            document.getElementById('login-popup').classList.add('hidden');
            signInWithCustomToken(data.customToken)
          }
          break;

        case 'close-popup':
          /* This action is executed when the button to close the popup is clicked,
          in this example the popup is hidden with the 'hidden' attribute */
          document.getElementById('login-popup').classList.add('hidden');
          break;
      }
    }

    function setUpLogin() {
      const loginIframe = document.getElementById('login-iframe');
      /****************************************************************************************
       The following configuration shows the parameters with which
       the application can be customized as follows:
       * If a parameter is not sent, the default value of the parameter will be taken.
       * If a parameter is sent with a custom value, it will be overwritten over the default value.
       * If a parameter with an empty value is sent, the value will be overwritten by removing
       the default values in case no value is to be displayed.
       ************************************************************************/
      loginIframe.contentWindow.postMessage({
        channel: CHANNEL,
        action: 'config',
        config: {
          project: 'aguilapenalties',
          /* String type parameter to indicate the application that is sending the request. */
          logoUrl: 'data:image/png;base64,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',
          /* String type parameter for the logo image URL or the base64 image. */
          sloganHtml: '',
          /* String type parameter for the slogan in HTML tag format. Example: <p>Our Slogan</p>. */
          showLoginFacebookButton: true,
          /* Boolean type parameter to show the login facebook button. */
          showSignUpFacebookButton: true,
          /* Boolean type parameter to show the sign up facebook button. */
          showOffersOption: false,
          /* Boolean type parameter to show offers options. */
          email: '',
          /* String type parameter for sample mail to be displayed as a value within the email field. */
          emailHint: '',
          /* String type parameter to show a suggestion of mail or text under the email field. Empty by default */
          passwordHint: '',
          /* String type parameter to show a suggestion of password or text under the password field. Empty by default */
          signUpLegalHtml: '<h1 class="text-sm font-bold mb-1 text-center">By registering you agree to:</h1><p class="text-sm text-center">Nuestros <a class="text-primary-500" href="/terms.html" target="_blank">Tapit Terms and Conditions,</a> the <a class="text-primary-500" href="/privacy.html" target="_blank">Privacy policies,</a> the <a class="text-primary-500" href="/data-proteccion.html" target="_blank">Personal data protection policy</a> and sending exclusive offers to my email. <br><br> The processing of my personal information by Bavaria & Cía S.C.A. for the purposes and uses required by Beer Poker described in the aforementioned policy. <br> <br> I confirm that I am over 18 years of age.</p>',
          /* String type parameter for legend of acceptance of terms and conditions when the user registers, in HTML tag format. SSO can recognize and apply tailwind css classes */
          loginLegalHtml: '<p class="text-sm text-center">By logging in you are accepting our <a class="text-primary-500" href="/terms.html" target="_blank">Tapit Terms and Conditions,</a> the <a class="text-primary-500" href="/privacy.html" target="_blank">Privacy policies,</a> the <a class="text-primary-500" href="/data-proteccion.html" target="_blank">Personal data protection policy</a> and sending exclusive offers to my email. </p>',
          /* String type parameter for legend of acceptance of terms and conditions when the user registers, in HTML tag format. SSO can recognize and apply tailwind css classes */
          showCloseButton: true,
          /* Boolean type parameter to show the close button. */
          showContainerBackground: true,
          /* Boolean type parameter to show the container background. */
          styles: '.text-primary-500{color: #da291c;} .bg-primary-500{background: #da291c;} .border-primary-500{border-color: #da291c;} .logo {padding-top: 15px;}',
          /*  String type parameter to add custom stylest in CSS format. Empty by default */
          interests: [
            /* Object type parameter to add cutom inputs.
                Each custom input must be made up of a key and a label.
                The password will be saved in the database in the interests property, only if the user selects that interest
            */
            {key: 'cerveja', label: 'Cerveja'},
            {key: 'sertanejo', label: 'Sertanejo'},
            {key: 'futebol', label: 'Futebol'},
            {key: 'nenhuma', label: 'Nenhuma'},

          ],
        }
      }, TAPIT_ORIGIN);


      /**
       *
       * REQUESTS TO THE LOGIN PAGE TO SEND US THE DATA OF THE LOGGED USER THERE
       *
       **/
      /*loginIframe.contentWindow.postMessage({
        channel: CHANNEL,
        action: 'get-logged-user',
      }, TAPIT_ORIGIN)*/
    }

    function showLoginPopup() {
      document.getElementById('login-popup').classList.remove('hidden');
    }


    /**
     *
     * FIREBASE CONFIGURATION AND USE
     *
     **/
    var FIREBASE_DEV = {
      apiKey: 'AIzaSyB822NxnsV-CB_k5E78q76jaqnCC4ohfVI',
      authDomain: 'clube-brahma.firebaseapp.com',
      databaseURL: 'https://clube-brahma.firebaseio.com',
      projectId: 'clube-brahma',
      storageBucket: 'clube-brahma.appspot.com',
      messagingSenderId: '226852992923',
      appId: '1:226852992923:web:1ad18fa74cab2f9826933e',
      measurementId: 'G-9P28VMNFGR'
    };

    firebase.initializeApp(FIREBASE_DEV);

    /* The recommended way to get the current user is to set an observer on the Auth object */
    firebase.auth().onAuthStateChanged(function (userCredential) {
      if (userCredential) {
        /* Get user data */
        firebase.firestore().collection('user_account_tap').doc(userCredential.uid).get()
          .then(function (documentSnapshot) {
            document.getElementById('firebase-user-data').innerText = JSON.stringify(snapshotToUser(documentSnapshot));
          })
          .catch(function (error) {
            console.error(error);
          });
      }
    });

    function signInWithCustomToken(customToken) {
      firebase.auth().signInWithCustomToken(customToken)
        .then(userCredential => {
          /* Next steps after login */
        })
        .catch(function (error) {
          console.error(error);
        });
    }

    function snapshotToUser(documentSnapshot) {
      const user = {id: documentSnapshot.id, ...documentSnapshot.data()};
      user.referralCode = user.referralCode ? user.referralCode.id : '';
      return user;
    }
  </script>
</head>


<body>
<div class="text-center my-32" id="login-button">
  <button class="app-button bg-primary-500 text-white" onclick="showLoginPopup()">INICIA SESIÓN</button>
</div>

<div class="m-4 rounded-lg bg-neutral-200 p-4">
  <h1 class="font-bold">IFRAME LOGGED USER</h1>
  <p id="iframe-user-data" class=" overflow-x-auto"></p>
</div>

<div class="m-4 rounded-lg bg-neutral-200 p-4">
  <h1 class="font-bold">LOCAL LOGGED USER</h1>
  <p id="firebase-user-data" class=" overflow-x-auto"></p>
</div>

<div class="m-4 mt-20 rounded-lg p-4">
  <a href="/index.html" download>Download source code</a>
</div>

<div id="login-popup" class="hidden mx-auto max-w-md">
  <div class="fixed bottom-0 inset-x-0 sm:inset-0 sm:flex sm:items-center sm:justify-center">
    <div class="fixed inset-0 transition-opacity">
      <div class="absolute inset-0 bg-neutral-500 opacity-75"></div>
    </div>
    <div class="bg-white rounded-lg overflow-hidden shadow-xl transform transition-all sm:max-w-lg sm:w-full"
         role="dialog" aria-modal="true" aria-labelledby="modal-headline">
      <iframe class="w-full max-h-screen" id="login-iframe" onload="setUpLogin()"
              src="https://clube-brahma-sso.web.app/login"
              style="height: 773px"></iframe>
    </div>
  </div>
</div>
</body>
</html>
